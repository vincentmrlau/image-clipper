<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>image-clipper</title>
    <style>
        body{
            background-color: wheat;
        }
        #clipper-container{
            height: 500px;
            width: 400px;
            max-width: 100%;
            background-color: white;
            position: relative;
        }
        img{
            border: solid brown 1px;
        }
    </style>
</head>
<body>
    <div id="clipper-container"></div>
    <p>
        controller:<br>
        <label>choose an image:<input id="file" type="file" accept="image/*"></label><br>
        <button id="clockwise">rotate-clockwise</button><button id="anticlockwise">rotate-anticlockwise</button>
        <br>
        <button id="clip">clip!</button><br>
        result:
        <br>
        <img id="result" src="" alt="">
    </p>
    <script src="Clipper.js"></script>
    <script>
        /*
        * demo by vincent lau
        * */
        let container = document.getElementById('clipper-container')
        document.body.onload = function () {
            let clipper = new Clipper(container, {
                coverShape: 'circle'
            })
            document.getElementById('file').onchange = function (event) {
                console.log(event.target.files[0])
                let fileReader = new FileReader()
                fileReader.onload = function (e) {
                    clipper.drawImg(e.target.result)
                }
                fileReader.readAsDataURL(event.target.files[0])
            }
//            clipper.drawImg('/images/particle.png')
            //rotate
            document.getElementById('clockwise').onclick = function () {
                clipper.nextRoatetion -= 0.1
            }
            document.getElementById('anticlockwise').onclick = function () {
                clipper.nextRoatetion += 0.1
            }
            // clip
            document.getElementById('clip').onclick = function () {
                clipper.clip(function (data) {
//                    console.log(data)
//                    let fileReader = new FileReader()
//                    fileReader.onload = function (e) {
//                        document.getElementById('result').src = e.target.result
//                    }
//                    fileReader.readAsDataURL(data)
                    document.getElementById('result').src = data
                }, {
                    format: 'base64'
                })
            }
        }
    </script>
</body>
</html>